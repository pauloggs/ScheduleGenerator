# ScheduleGenerator
An API to GET the recipe information from RecipeApi and generate lighting and watering schedules.

# How to run
TBC

# Dev Approach
The first steps were to create an API that could connect to the RecipeApi. Initially the ScenariosGenerator would just return back the list of Recipes.

The second step was to ensure that this new API would run in a Docker container and be able to connect to the RecipeApi container. This is achieved by a section of the docker-compose file that connects to the network that is created when the RecipeApi container is run (there is a manual step however to find the IP address of this RecipeApi container and modifying the ScenarioGenerator docker-compose file before running).

Generally the approach has been the following sequence
1. Decide on the modelling
2. Break up the processing into different services (Http, Converter, Processing)
3. Implement each service with unit tests

# Modelling
The main decision here was how to model the output of commands that would be the end product of all the processing.

It seemed sensible to separate the list of watering commands from the lighting commands, since from a domain-driven design point of view they probably represent physical actions taken by completely different sets of machinery.

**Output**

_TowerCommands_
* List > _LightingCommand_
* List > _WateringCommand_ 

_LightingCommand_ and _WateringCommand_ both inherit from the abstract class _Command_, which holds the execution datetime, tray number and recipe.
Strictly speaking the _Command_ object doesn't really need the recipe property, but it's included in the interests of ensuring that the right command is being applied to the right recipe.

**Input**

There are two parts to the input model, first there's the actual request that is posted containing the list of (tray number / start datetime / recipe) combinations. This object that represents this is called _RecipeTrayStarts_. And secondly there is a _Recipe_ object, a List of which represents the recipe data that is returned back from the _RecipeApi_.


# Processing
The commands for the tower were generated by the following algorithm
* Loop through each (tray number / recipe / start datetime) combination in the posted request
* lookup the Recipe, throw an exception if not found

* to generate the _WateringCommand_ list
* > order the _WateringPhase_ list by the order property
* > for each _WateringPhase_
* > > for each Repetition
* > > > set the _currentDateTime_ by adding the hours and minutes
* > > > create a _WateringCommand_ with this time, with the _Amount_ of water specified by the Recipe
* to generate the _LightingCommand_ list, there's an additional step that handles operations:
* > order the _LightingPhase_ list by the order property
* > for each _LightingPhase_
* > > for each Repetition
* > > > get 


# Issues
TBC